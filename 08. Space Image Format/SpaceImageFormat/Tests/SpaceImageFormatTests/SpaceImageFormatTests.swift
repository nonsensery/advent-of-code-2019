import XCTest
import SpaceImageFormat

final class SpaceImageFormatTests: XCTestCase {

    func testPart1Result() {
        let result = SpaceImage(data: inputData, width: inputWidth, height: inputHeight).checksum
        XCTAssertEqual(result, 2193)
    }

    func testPart2Result() {
        let result = SpaceImage(data: inputData, width: inputWidth, height: inputHeight)
            .flattened(transparent: 2)
            .map {
                $0.map({ $0 == 0 ? "⬛️" : "⬜️" }).joined(separator: "")
            }
            .joined(separator: "\n")

        XCTAssertEqual(
            result,
            """
            ⬜️⬛️⬛️⬛️⬜️⬜️⬜️⬜️⬜️⬛️⬜️⬛️⬛️⬜️⬛️⬜️⬜️⬜️⬜️⬛️⬜️⬜️⬜️⬜️⬛️
            ⬜️⬛️⬛️⬛️⬜️⬜️⬛️⬛️⬛️⬛️⬜️⬛️⬛️⬜️⬛️⬜️⬛️⬛️⬛️⬛️⬜️⬛️⬛️⬛️⬛️
            ⬛️⬜️⬛️⬜️⬛️⬜️⬜️⬜️⬛️⬛️⬜️⬜️⬜️⬜️⬛️⬜️⬜️⬜️⬛️⬛️⬜️⬜️⬜️⬛️⬛️
            ⬛️⬛️⬜️⬛️⬛️⬜️⬛️⬛️⬛️⬛️⬜️⬛️⬛️⬜️⬛️⬜️⬛️⬛️⬛️⬛️⬜️⬛️⬛️⬛️⬛️
            ⬛️⬛️⬜️⬛️⬛️⬜️⬛️⬛️⬛️⬛️⬜️⬛️⬛️⬜️⬛️⬜️⬛️⬛️⬛️⬛️⬜️⬛️⬛️⬛️⬛️
            ⬛️⬛️⬜️⬛️⬛️⬜️⬜️⬜️⬜️⬛️⬜️⬛️⬛️⬜️⬛️⬜️⬜️⬜️⬜️⬛️⬜️⬛️⬛️⬛️⬛️
            """
        )
    }

    static var allTests = [
        ("testPart1Result", testPart1Result),
        ("testPart2Result", testPart2Result),
    ]
}

let inputWidth = 25
let inputHeight = 6
let inputData = """
    2202122222222222222222222122222222222222222202220222220212022221222122221202022222222222222202220220222222222022
    0221202222220022222222220222221221202222222222222222222222222220222222222222222222122202222212221222202220222202
    0222222222222222220222222222222222222202212022222210222222222202222212202022222222222222222222222222212222222222
    2222222212221222220202122221222222221212122222222222222202220220222222222222122120222222022222222222022222022120
    2222120222222222222222222222222222222222222222022022222222122222202220222222220222222222222222022112212222222222
    2222212222222201222222222202222202202022220202222222222222222222222222222222222222222222022222120212222122212222
    0212022222222222222222210220222222222222122021222222212222222222022222122021222222222222222222222222222122222222
    2222222222022002222212020222222221222212022222222222222222122222222222222222221222222222220222222222222222221220
    2122220202222222222222222222202222222222222222222222222222122202222022222221022202222222222222221220222122222222
    2012122220222222012222222222022222022022222222022222222222222222222122222222222222222222202222222212122221222022
    2022122222222222222222222112202222222220020222202222220122222222221222221222202222122222222222222222221221222222
    2222222222222222022222222222222122212221121222222222222222221220122122222222210202212122222211222222222222222222
    2122222212122222222222222222022022222222222222222222212222222222022221222122200202122222222222222212220222222222
    2221220220202222220022222222220222220222212222120222222222222222221220222222222222222222122202222212122222202222
    2221220202222222222222221222022222222222211202202122222211222212222202222112222022222202222222222222222222212222
    2222222222222222220222220212222220222022220202222222222222222212211221222222222102122222222222010222022222022221
    2220222222222222222222222222221221222220222222222222022122222202020222222220222212121222222222222222022112202222
    2222221202202222222212222202222212222012222022220202222222222122222212222222212222222222221221022222220212222022
    2122222212122212222222222222221221222222222012022022222222012222222222122221122022222222022222222221222222022022
    2221222222222222222102222202120222122220222222120222022222222222222212202220222220121220212222222222221222221222
    2202202122220222222222222222222212212222220222222222220222022222222212221022222222222212222222222222220222122222
    2122222002122020222222112222222222222221022122222202222222222221222222022122222022222222222222220222220212022212
    2220222002222222022222222222022002222222222222222222212222221222220222220222222222222222122222222222202222221222
    2222222222222222220221022222120212222222222220122202221222222222221220222122212222200222212120222221122202222222
    2220122222222212022222222220222222222222222022222222222202220222220212222211222022221212022222222222222202222221
    2222222220021221222222221222220222222222222222202222020222222222202222222221222221122222222222220002222212120222
    1122222222221222020222222222201220022122222222211222202021222211222222222202222222212022222202222222222122222212
    2022222122222222222212021222221212222200222122201212122222222222222122210220222022222222122120202222210222022222
    1222210222202222020222222222212222220222222220222222222222220002222222220222212222222102221202222222222212122002
    2022202222221212222220222212222202222222222202222122220202222222222122222202202222222222222222220210122222020212
    2202222122210202021212202222220112220220222022222022222121222222110222122222222220022121222022222222222222222222
    0221222220022222222222021202222212221222202220222212022212022122222211022222212221222221121222202120221212222222
    2212222122202222221222222222220222222202222222200222222222222201222222122202212022202222121222120220222222212220
    1221222122222212122021212022010222222222122221022120222102222222222200222222022122222012222222222202012222221212
    2221112220222002222222122222222220122112202222222220121220212022222222222222221222202221222221020222222222202222
    2212222222201222222222222201122222211202220022202220121212121222222222110220222122202222221222012120202201222212
    2222222222220120222012122222222202222222222222222122222222222202212222221202222212222222212222022222212222221112
    2212212221222222022221202220201002221222221222221212222221221222222222102222221221222221222222222222022022222211
    1212212022202220221211022222222222111222222222202222200212122221222011022222222212222022212122200222222222221122
    2222222122222112222222222222000222221002122100222122211002222202202222222222211221222222222112221121202221220222
    0222222222212222202221120222222222112222222222222221022222222222020122222211021222102220222112022022022102222210
    2220222022222222210202002122212112122222222222222022022120211212222222220122222202212222222222222022222220122222
    1102022201222122222012101222220222220002201220222222222202221222202220022222122222222221021100202112022222222211
    2222220220222222022222202222221102222211220222202221222210221112022212222201122022012222222020220202222122220102
    2222222222222002020121212202222222220022222202222222202222222122222221122222010202220122212220011210122220022222
    2222210202222022222012222022202220122222022222122221122221222222122222222222222222222222222212222222222222220222
    2201021221022221222200022212122202222221222222012222222221222202202220210102221222222222220212002222122222222222
    1122222222202222202222222122221202222222001222202222202220110021020221222222002222020222212221211212222222212110
    0222122222022222022120222102022222222201222222222122222002222220222212022222222202222111222022202201202212212222
    2201022212112220222222121222212022201002202222221222212210212222121222222222102222222221222222222220202222220002
    2222222212202022212221210112121220022222220222221122202222202212012021202211122222222222222202000022211222222222
    2210222222122022222202222221222212011222222112222200222222210220222212200222221112200220222022212212220121212222
    1102221222220222220211202222222222222222222222222221222220022220202222020212222202120222122221222101011122022102
    2222001221121122220222222222122022222211222202222212222102220120212212222222221222222202222222221222202122220201
    0222222002222212222222200200211222201222220112200200222002202212120020202221222222122222122221020120202212122222
    2222122222220222222221222221212222220222220201021220022220222212210002122022222222122122002222022220220201222020
    2212220212222212222212211222211222222222222122222202222222202222212022220212222112111202202222222222121011221220
    1222221002220220222012202022122120202222220200022222022222221000202222222122222212222222122222222112222020222222
    2212201222021221102221222121011122022222222202022002022220222120122221202122210012010222221222201220202220121222
    2222220122221212212222200222202122220220222022020212211122202221012002220222122222002221020022211221211222202222
    2222222201222222202221020001222112022222222221222222220122222122222121222202000221220122222012221222202220102222
    2222222222222002022220222122121210202022201212122222222022212202012222122220222222102222022220222220122220202222
    2200122022021202210122122222000100121222022222101220222220212222201202112122202212022112222222222212112020200222
    2122222211222222021122222002222220222212111222121022022212222122211100121222220222221002212202212102212022122021
    2121222212222222222022222220202022221220222222022222022212222221222220102222221102220212222221102210222120200122
    2220122222122221120020202220211212202121222002122202222220222202012221202211212222221022222212122222210222201222
    2212200221120022122102222122211021122212200222221012222222212222202012022021202222120220122222202220121201222202
    1020222222012222221201222221022220122222120212210211120221002211222220201122022222222221022222202120022220022200
    2120202100220222222211222002001121211212202222221122222212112222201222201222220200222012221202211222122220212000
    1222200222221112221201222212222022222022022122210202022222222222122122212112022222222220222212122022222012222101
    2222121212220212020220212210222211120012122212222202222012022121222220120201200222222122021222222122220202102021
    1212202222220122222222222022220202220022221202122012102222212222002221221022021221022222220220220122200221222202
    0201102101201210022222022222221102222212122222222201212222120221222102222121222202112222120122222122222022200020
    2122122112222222122202212220022022021211222120002002102222222122220212002222221021222222202022220221212222021221
    0122221211222112110202200122112220112012222220222222100221221221200220210222112101211001020202222202222211022021
    2122112222222201212212122221222212122010222212122222222102022000220222221202201202211222222122202200212002222212
    0202012221122002001222221122211102102122021220222222102022022212202220020221202222221002201200222221002212222100
    2202021222122222000220220021200120221212220112210010021222222202222122102121212211222222222220222222102122211202
    2212222202202221120002122201221022221012101222202222220222211221222212002102220220222010010212122222212222010021
    2121020020222222022122021200202122121222212222120012212220022221202220222022212212022222022210222222012022111221
    2001112100220222120012222201222121022221202210222222220120222212202121211222211222222221222112212222210022112221
    0021112212210212222012210222202000012112100022022200201220022222122220212002222002202022222200202222120121212002
    0222112222121002200220120221022200222202021002122102202201222012002220202120222000202121100112122222221122210220
    0121221222222222222122222202222120200212210222220200122202221222211022000220020122021222121022200220220222211101
    2001200012122000022202022222212220221220202012212222222212202212120020222212022002222212122220021102122101220002
    2012011012222112202200222202222020122222122001220020211112012222220222202211102222221220222222022022021212202122
    1222210022221210122212011212202022020222100112221220221122000220221221210220202021210102211211221222222222222100
    2121222012102122222200212222121120202102122110222222200220020012121211221122202211021212220202221202202210202120
    2222012022000120121112100222222222221110102121120021222222002022021210212221121222022222021212221200020220122201
    1221020011021221021122111222220021220020202102012121102202210011212222222202120222211202222222220121220222012222
    2022122002222202022221020212021002020222200222020212220221222202211222222112202210202111000112211222012122122220
    0211112022221222222222121122222201220121221222202222221212202220020211200211222020211102222212022202222112202120
    1022222022120001101011021121202212221111102020221211202222222102220202112102211212220222222221022102011202121222
    2122202001102202220211222222201222202111022101120120220212111001012022022200212122222102002222222211102212222220
    2021022222212222222022210201122222021212222202011012022222102010022202212120112021221102010222021111112020221022
    1002011021211220202222222111220212022021221202212222220210122212200202200102220222000102220201221120221222220222
    2012022100110001110120022202222222112212201121212102202022222221212212220121002202122001222202000222222222121022
    0201022001002122022212112121022102012021221221111122000012012111112020220222122201202022021021222222111022221220
    2022220202222222221211222102101222222022002221021210221222121021002022120121220111211120211001110212121110212221
    2202010000202102202122222201012212020220112222022101222222221221221202121222222202202102102212120211200022212211
    2122100220211212211201120212012111221022201100212020220220222222000122020210202221020222202222121202221212222222
    0122212221122201021221210022220122122020212011200111210110022110102001012200122210122121212200212222222012221202
    0221112012020002222202112222220122022101120222222012202212020002212100211201222100122202002002012021112101221222
    1202200022002220222121222222012122121220212022222211012222020202221201120200110102122222111222120202122212112222
    1122210022200021011002210021120020122202020111200020221222202222220220221222022010222222000222221212022022101202
    0202222002222122201212001220220021210212212211222200021100210000220210100222100200120112202202122122222212022202
    1210200021120210012222111012200222021221021222222112000012120221102111122102212221010021202212102121002202100000
    2220222212200220200200212222221012220212002201200202112122220021122102120212210022101220002112022222011020122101
    2200222112212112020222121021000202112122100221211021202212012122222212212222121220002012022021222211101220120222
    1221002010122100101212222110102022212002212120110120202020212100112020210220222202101221122120222220222222001222
    2202002201210212022122200122122212120222210212010221222220020211221121111012022222210202200201221002101220222211
    1222012212101121222212122122222200022212022221012212221100222020001220122002120200010102220021102222222010202100
    2002222022111122000010010201111211021200220020102101112220120220222222111022020221210122221202112220101112211202
    0212120000221221000022220201101022022101220120220100202021220220222221200211222200010200112022201200222222221100
    2222120121222112220020222111021222022022021000200222201012210212012110221102200222212111012022212202211012102010
    2000221110022111002020022120222222211222020201211022021200122222220022222222021210000110022120120122021212221221
    2200220021210101201221200010212021121212212222210202220122220200222222222102222222022210202212100122211200022222
    1222222011122102212121101212122211222002021211212111102020212112002001001001120222100112121111222202022222222222
    1022021211202020020220202221001202201212220222020222122220200012021010111211102222002021002220001121222110212010
    2112112202121200010122222210202222221110221212102020221212202222202010022002021212112202200220022020001211112222
    0000200212202010002220120020112022222110202122211111121212212122222122222210222212022022012202222111222011220220
    1202020200112020222012222210020200202210002002102120220222210210022122002022112210222021200222102221221020222222
    0200221202002201210222210222221110122222020222012111120222001002211201220202220022021202202121202011020102222111
    0022200022001012222220222212112022222220212222022220202202021011222001112221120112220011201122221220201022020020
    0212020112201121210222200111001010212221202001220011110012212121222220222222101022121222211022220200122020001102
    2002220202111111022221102202000211200212012122120111210201222121120022110222020211102220120020222021211222222222
    2222002212022220202122122100212111200221022122122121002002202100101202010100120112202200112220002120111112222101
    2210200021222220101000122220022021222222020022222210200220121221112021100212220222122201001111022212012221120021
    1022212211122021222202201021022222200000202021222221010120011021221221212222221001120102202122211212121022211101
    0222022112122211112112211122210012001021020100012201202000222220121111202122221110010122212212010111222200201222
    2022210022121222201122221211022021220222210212121202122211222211021021222020122011021202200222011120121021210000
    1000220021122210222120011102212000202222220212222002022221211012002020212012022222011222112111220220101121021212
    1012101202021210002220222220202211011200010102201122101111020210021220210110110101001002210201021010112222120121
    20200121111100111120001011210100101012201111001110201020101122001011000001200120101101120121021100210212
    """
    .compactMap({ $0.wholeNumberValue })
